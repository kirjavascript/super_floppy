var k=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var C=(e,t)=>{for(var r in t)k(e,r,{get:t[r],enumerable:!0})},F=(e,t,r,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of j(t))!D.call(e,n)&&n!==r&&k(e,n,{get:()=>t[n],enumerable:!(c=W(t,n))||c.enumerable});return e};var U=e=>F(k({},"__esModule",{value:!0}),e);var Z={};C(Z,{Comlink:()=>A});module.exports=U(Z);var A={};C(A,{createEndpoint:()=>O,expose:()=>T,finalizer:()=>w,proxy:()=>I,proxyMarker:()=>x,releaseProxy:()=>L,transfer:()=>v,transferHandlers:()=>S,windowEndpoint:()=>K,wrap:()=>H});var x=Symbol("Comlink.proxy"),O=Symbol("Comlink.endpoint"),L=Symbol("Comlink.releaseProxy"),w=Symbol("Comlink.finalizer"),h=Symbol("Comlink.thrown"),z=e=>typeof e=="object"&&e!==null||typeof e=="function",G={canHandle:e=>z(e)&&e[x],serialize(e){let{port1:t,port2:r}=new MessageChannel;return T(e,t),[r,[r]]},deserialize(e){return e.start(),H(e)}},Y={canHandle:e=>z(e)&&h in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},S=new Map([["proxy",G],["throw",Y]]);function q(e,t){for(let r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function T(e,t=globalThis,r=["*"]){t.addEventListener("message",function c(n){if(!n||!n.data)return;if(!q(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}let{id:a,type:g,path:l}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(y),s;try{let o=l.slice(0,-1).reduce((i,d)=>i[d],e),f=l.reduce((i,d)=>i[d],e);switch(g){case"GET":s=f;break;case"SET":o[l.slice(-1)[0]]=y(n.data.value),s=!0;break;case"APPLY":s=f.apply(o,u);break;case"CONSTRUCT":{let i=new f(...u);s=I(i)}break;case"ENDPOINT":{let{port1:i,port2:d}=new MessageChannel;T(e,d),s=v(i,[i])}break;case"RELEASE":s=void 0;break;default:return}}catch(o){s={value:o,[h]:0}}Promise.resolve(s).catch(o=>({value:o,[h]:0})).then(o=>{let[f,i]=M(o);t.postMessage(Object.assign(Object.assign({},f),{id:a}),i),g==="RELEASE"&&(t.removeEventListener("message",c),N(t),w in e&&typeof e[w]=="function"&&e[w]())}).catch(o=>{let[f,i]=M({value:new TypeError("Unserializable return value"),[h]:0});t.postMessage(Object.assign(Object.assign({},f),{id:a}),i)})}),t.start&&t.start()}function X(e){return e.constructor.name==="MessagePort"}function N(e){X(e)&&e.close()}function H(e,t){let r=new Map;return e.addEventListener("message",function(n){let{data:a}=n;if(!a||!a.id)return;let g=r.get(a.id);if(g)try{g(a)}finally{r.delete(a.id)}}),P(e,r,[],t)}function E(e){if(e)throw new Error("Proxy has been released and is not useable")}function V(e){return m(e,new Map,{type:"RELEASE"}).then(()=>{N(e)})}var b=new WeakMap,p="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(b.get(e)||0)-1;b.set(e,t),t===0&&V(e)});function $(e,t){let r=(b.get(t)||0)+1;b.set(t,r),p&&p.register(e,t,e)}function B(e){p&&p.unregister(e)}function P(e,t,r=[],c=function(){}){let n=!1,a=new Proxy(c,{get(g,l){if(E(n),l===L)return()=>{B(a),V(e),t.clear(),n=!0};if(l==="then"){if(r.length===0)return{then:()=>a};let u=m(e,t,{type:"GET",path:r.map(s=>s.toString())}).then(y);return u.then.bind(u)}return P(e,t,[...r,l])},set(g,l,u){E(n);let[s,o]=M(u);return m(e,t,{type:"SET",path:[...r,l].map(f=>f.toString()),value:s},o).then(y)},apply(g,l,u){E(n);let s=r[r.length-1];if(s===O)return m(e,t,{type:"ENDPOINT"}).then(y);if(s==="bind")return P(e,t,r.slice(0,-1));let[o,f]=R(u);return m(e,t,{type:"APPLY",path:r.map(i=>i.toString()),argumentList:o},f).then(y)},construct(g,l){E(n);let[u,s]=R(l);return m(e,t,{type:"CONSTRUCT",path:r.map(o=>o.toString()),argumentList:u},s).then(y)}});return $(a,e),a}function J(e){return Array.prototype.concat.apply([],e)}function R(e){let t=e.map(M);return[t.map(r=>r[0]),J(t.map(r=>r[1]))]}var _=new WeakMap;function v(e,t){return _.set(e,t),e}function I(e){return Object.assign(e,{[x]:!0})}function K(e,t=globalThis,r="*"){return{postMessage:(c,n)=>e.postMessage(c,r,n),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function M(e){for(let[t,r]of S)if(r.canHandle(e)){let[c,n]=r.serialize(e);return[{type:"HANDLER",name:t,value:c},n]}return[{type:"RAW",value:e},_.get(e)||[]]}function y(e){switch(e.type){case"HANDLER":return S.get(e.name).deserialize(e.value);case"RAW":return e.value}}function m(e,t,r,c){return new Promise(n=>{let a=Q();t.set(a,n),e.start&&e.start(),e.postMessage(Object.assign({id:a},r),c)})}function Q(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
